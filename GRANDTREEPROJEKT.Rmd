---
title: "STIN100 Datasett 2: Analyse av genuttrykk for å forstå effektene av gammastråling på gran"
author: "Benjamin Johan Madsen & Aksel Vardeberg Skeie"
date: "16 oktober 2018"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float:
      collapsed: false
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
#Kjørte disse linjene for å gjør øvelsen litt vanskligere og mer innteresant.

#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
```

```{r, include=FALSE}
library(readr)
Aksel <- readr::read_tsv("gene_expression_readcounts.tsv")
head(Aksel)

View(Aksel)
```

##1. Hvor mange rader (gener) og kolonner (prøver) har vi i tabellen?

Vi bruker funskjonene ```nrow``` og ```ncol``` for å telle opp antall rader og kolonner. Det er 21 rader og 66069 rader i tabellen *gene_expression_readcounts.tsv.*  
```{r,}
Antall_rader <- nrow(Aksel)
Antall_kolonner <- ncol(Aksel)
```

##2. Skriv en kode som teller hvor mange replikater vi har per behandling (dvs stråledose) basert på kolonnenavnene?

```{r}
library(tidyr)

separate(Aksel, geneID, into=c('dosage', 'replicate'), sep= "-", remove = TRUE, convert = FALSE)
```

##Bruk ggplot() + geom_bar(stat="identity") til å visualisere antall RNAseq reads vi har sekvensert for hver prøve i hver behandling.
```{r}
readCount <- colSums(Aksel[,-1])
readCount

d <- data.frame(navn = names(readCount),read = as.numeric(readCount))
d <- separate(d, navn, into=c('dosage', 'replicate'), sep= "-", remove = FALSE)

#colsum(d)

```

```{r}
samplecols = c(G0="lightgrey", G1="grey", G10="darkgrey", G40="red", G100="darkred")

library(ggplot2)
ggplot(d,aes(x=navn,y=read,fill = dosage)) + geom_bar(stat="identity") + scale_fill_manual(values = samplecols)
```

##Hvor mange gener har 0 (dvs ikke målbart genuttrykk) i minst en behandling?

```{r}

library(dplyr
        )
Stack_col <- gather(data=Aksel, key= sample, value = uttrykk, -geneID) %>% group_by(geneID) %>% summarise(zeroTPM=  sum(uttrykk == 0))

table(Stack_col$zeroTPM)

mytable <- table(Stack_col$zeroTPM) 

sum(mytable[2:21]) #Hvor mange gener har 0 (dvs ikke målbart genuttrykk) i minst en behandling?  
sum(mytable[21])#Hvor mange gener har 0 i alle behandlinger?

#Om gener der det finnes få eller ingen data på genets reads kan vi enten forstå det sånn at genet ikke blir påvirket av stråling eller ikke er skrudd på. Det kan også være at genmengden som ble sekvensert ikke var tilstrekkelig for å få en full lesning, og genet blir dermed regnet som ikke påvirket
```

##1.5 Normalisering av genuttrykksdata for variable datamengder per prøve (antall reads)


